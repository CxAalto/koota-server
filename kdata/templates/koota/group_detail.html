{% extends "koota/base.html" %}

{% block title %}{{ group.dbrow.name }} - Koota{% endblock%}

{% block body %}

<h2>Basic information</h2>
<ul>
<li>Name: {{ group.name }}</li>
</ul>

<h2>Statistics</h2>
<ul>
<li>Number of subjects: {{ group.dbrow.subjects.count }}</li>
<li>Effective number of subjects: {{ n_subjects }}</li>
<li>Start time: {{ group.dbrow.ts_start|date:"c" }}</li>
<li>End time: {{ group.dbrow.ts_end|date:"c" }}</li>
</ul>


<h2>Available converters</h2>

{% if not is_researcher %}
<p>You do not have "researcher" permission, so you can not view
  converters or individual subject data.</p>
{% else %}
<ul>
  {% for converter in group.converters %}
  <li><a href="{% url 'group-data' group_name=group.dbrow.slug converter=converter.name %}">{{converter.name}}</a>
      {{converter.desc}}
  </li>
  {% endfor %}
</ul>
{% endif %}


{% if group.dbrow.managed %}

<h2>Add a user</h2>
<a class="btn btn-warning btn-xs" href="{% url 'group-user-create' group_name=group.dbrow.slug %}">Add a user to this group</a>

<h2>Group users</h2>
<p>This is a managed group, users are below.</p>

<table class="table table-condensed table-striped table-bordered" style="width: auto !important">
  <tr class="info">
    <th>Hash</th>
    {% if group.dbrow.nonanonymous %}<th>Username</th>{% endif %}
    <th>ID</th>
    <th></th>
    <th>Type</th>
    <th>Usage</th>
    <th>#/lasty</th>
  </tr>
{% for groupsubject in group.dbrow.groupsubject_set.all %}
  <tr>
    <th>{{ groupsubject.hash }}</th>
    {% if group.dbrow.nonanonymous %}<td>{{ groupsubject.hash_if_needed }}</td>{%endif %}
    <td colspan="5">
      <a class="btn btn-primary btn-xs" href="{% url 'group-subject-detail' group_name=group.dbrow.slug gs_id=groupsubject.id %}">Subject data/info</a>
       <a class="btn btn-warning btn-xs" href="{% url 'group-subject-device-create' group_name=group.dbrow.slug gs_id=groupsubject.id %}">Create device for subject</a></td>
  </tr>
  {% if groupsubject.notes%}<tr> <td></td> <td></td> <td colspan="5"><i>Notes: </i>{{ groupsubject.notes|slice:":120" }}</td></tr>{% endif %}
    {% for device in groupsubject.allowed_devices %}
      <tr {% if device.label.analyze %}class="success"{% endif %}><td></td><td></td>
        <td>{{ device.public_id }}</td>
        <td><a class="btn btn-info btn-xs" href="{% url 'group-subject-device-config' group_name=group.dbrow.slug gs_id=groupsubject.id public_id=device.public_id %}">Config</a></td>
        {# <td><a href="{% url 'group-subject-device-detail' group_name=group.dbrow.slug gs_id=groupsubject.id public_id=device.public_id %}">Data</a></td> #}
        <td>{% if device.label.slug == "primary" %}<b>{% endif %}{{device.human_name}}{% if device.label.slug == "primary" %}</b>{% endif %}</td>
        <td>{{ device.label.shortname }}</td>
        <td>{{ device.summary_text}} <span style="color: {{device.summary_color|safe}}; float:right; border-radius: 50%">{{device.summary_char|safe}}</span></td>
      </tr>
    {% endfor %}
{% endfor %}
</table>

{% endif %}



{% endblock %}
